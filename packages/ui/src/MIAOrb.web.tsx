import React, { useMemo, useState, useEffect, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
export type OrbState = 'idle' | 'listening' | 'thinking' | 'speaking' | 'success' | 'warning';
function useBreathing(t = 1.06) { const [s, set] = useState(1); useEffect(()=>{ let m=true, d=1; const id=setInterval(()=>{ set(v=>{ const n=v+(d*0.003); if(n>t)d=-1; if(n<1)d=1; return m?n:v;}); },16); return ()=>{m=false; clearInterval(id);};},[t]); return s; }
function Particle({ radius = 140, i = 0, total = 6, speed = 8 }) { const ang = (i/total)*Math.PI*2; const ref = useRef<HTMLDivElement>(null); useEffect(()=>{ let m=true, tt=ang; const id=setInterval(()=>{ if(!m||!ref.current)return; tt+=0.01*(12/speed); const x=Math.cos(tt)*radius; const y=Math.sin(tt)*radius; ref.current.style.transform=`translate(${x}px, ${y}px)`; },16); return ()=>{m=false; clearInterval(id);};},[ang, radius, speed]); return <div ref={ref} style={{position:'absolute', width:8, height:8, borderRadius:9999, background:'rgba(255,255,255,0.7)', filter:'blur(0.5px)'}}/>; }
export function MIAOrbWeb() { const [state,setState]=useState<OrbState>('idle'); const [msg,setMsg]=useState('Ready.'); const scale=useBreathing(1.06); const satellites={idle:4,listening:6,thinking:8,speaking:6,success:5,warning:5}[state]; useEffect(()=>{ const m={idle:'Ready.',listening:'Listening…',thinking:'Thinking…',speaking:'Explaining…',success:'Done.',warning:'Hmm, check that.'}; setMsg(m[state]); },[state]); const ring={ idle:'linear-gradient(135deg, rgba(100,116,139,.4), rgba(148,163,184,.2))', listening:'linear-gradient(135deg, rgba(34,211,238,.6), rgba(99,102,241,.4))', thinking:'linear-gradient(135deg, rgba(139,92,246,.6), rgba(244,114,182,.4))', speaking:'linear-gradient(135deg, rgba(16,185,129,.6), rgba(34,211,238,.4))', success:'linear-gradient(135deg, rgba(34,197,94,.7), rgba(45,212,191,.4))', warning:'linear-gradient(135deg, rgba(245,158,11,.7), rgba(239,68,68,.4))', }[state]; return (<div style={{display:'flex',flexDirection:'column',alignItems:'center'}}><div style={{position:'relative',height:320,width:320,display:'flex',alignItems:'center',justifyContent:'center'}}><div style={{position:'absolute',inset:0,display:'flex',alignItems:'center',justifyContent:'center'}}>{Array.from({length:satellites}).map((_,i)=>(<Particle key={i} i={i} total={satellites} radius={135} speed={state==='thinking'?6:10}/>))}</div><motion.div style={{position:'absolute',height:288,width:288,borderRadius:9999,background:ring,filter:'blur(8px)',opacity:.6}} animate={{rotate:state==='thinking'?360:0}} transition={{duration:10,repeat:state==='thinking'?Infinity:0,ease:'linear'}}/><div><motion.div style={{transformOrigin:'center',scale,position:'relative',height:160,width:160,borderRadius:9999,background:'linear-gradient(135deg, rgba(255,255,255,.95), rgba(255,255,255,.8))',boxShadow:'0 0 80px rgba(255,255,255,0.35)',border:'1px solid rgba(255,255,255,0.3)'}}/></div></div><div style={{marginTop:12,color:'#cbd5e1',fontSize:12}}>{msg}</div><div style={{marginTop:16,display:'flex',gap:8,flexWrap:'wrap'}}>{(['idle','listening','thinking','speaking','success','warning'] as OrbState[]).map(s=>(<button key={s} onClick={()=>setState(s)} style={{padding:'6px 10px',borderRadius:9999,border:'1px solid rgba(255,255,255,0.2)',background:state===s?'#fff':'transparent',color:state===s?'#0b1220':'#fff'}}>{s}</button>))}</div></div>); }
